%Coding: utf8
%% @configure_input@
%%
%% Author: anzhou94@gmail.com
%% Date: Mon 08 Mar 2021 09:36:36 AM CST
%% Version: 0.0.1
%% License: BSD
%%
%% This template is helpful to use lualatex to produce a PDF format
%% electric book. It is useful if need support Chinses.
%%
%% The tmeplate is a demo while it works well.  So we can use Lua
%% in TeX to extend TeX.
%%
%% Most of the following packages need compile the input tex files
%% more than once, because some auxiliary tools need auxiliary files
%% that produced after the first compiling.
%%
\documentclass{article}
%%
%%%%%%%%%%%%%%%%%%%
%% 0. 调试、追踪 %%
%%%%%%%%%%%%%%%%%%
%% If you need time to coffee, just uncomment the following line
%% and traceon some lines. :)
%\usepackage{trace}
%%
%% Follow rpmbuild style, we always try to give more building infos.
\listfiles
%%
%%%%%%%%%%%%%%%%%
%% 1. 汉语支持 %%
%%%%%%%%%%%%%%%%%
%% To support Chinese, you can use the package ctex package. And
%% need add and set Chinese fonts.
%% On UNIX platforms we need add Chinses fonts first, that's why we add
%% nofonts option.
%% It is obvious that only a few of free serif Chinses fonts.
%%
\usepackage{metalogo} % Need the package for LuaTeX/LuaLaTeX logo.
%%%%%%%%%%%%%%%%%%
%% 1.1 引入CTeX %%
%%%%%%%%%%%%%%%%%%
\iftrue
\usepackage[UTF8, fontset=none, scheme=chinese]{ctex}
\else
\usepackage[UTF8, scheme=chinese]{ctex}
\fi
%%

%%
%% Configure math fonts before we use package fontspec, so we can
%% avoid influencing math settings when enble fontspec package.
\usepackage{amsmath}
\usepackage[math-style=TeX]{unicode-math}
\setmathfont{Asana-Math.otf}
%%

%\usepackage{fontspec} % CTeX自动调用之
%% It is said that, on PC, to use sans serif fonts is better than
%% to use sans fonts, so we do not need add AR PL UMing CN font
%% if you are not desired.
%%
%% The following fonts need package.
%% They are here
%% https://github.com/adobe-fonts/source-code-pro
%% http://developer.android.com/design/style/typography.html
%% For WenQuanYi, pls visit here
%% http://wenq.org/cloud/fcdesigner.html
%% For Droid Sans, pls start from here
%% http://en.wikipedia.org/wiki/Droid_fonts
%%
%% The Free Chinese Fonts
%% http://www.freechinesefont.com
%%
%% Because xeCJK has the following configure:
%% \defaultCJKfontfeatures{Script=CJK}
%% So, you may notice some error msgs like this
%% * fontspec warning: "script-not-exist-latn"
%% *
%% * Font 'WenQuanYi Micro Hei' does not contain script 'CJK'.
%% * 'Latin' script used instead.
%% That's OK, just skip these error msgs.
%%
%% To explain what is a font script. You can visit here
%% http://en.wikipedia.org/wiki/OpenType#Script_tags
%% The truetype has an extension that support script and language tags.
%% And 'hani' express script CJK. You can check some font files
%% as follows
%% fc-list :lang=zh # To find font file
%% showttf path_to_font_file # A lot of outputs, pls pipe it to a file.
%% showttf path_to_font_file | grep 'Script\['
%%
%% Another perhaps warning, if you use WenQuanYi fonts, as follows
%% ** WARNING ** TrueType post table name index 32768 > 32767
%%
%% This perhaps is lualatex or fontspec bug, I do not have enough time to
%% study the truetype specifications.
%%
%%%%%%%%%%%%%%%%%%
%% 1.2 字体配置 %%
%%%%%%%%%%%%%%%%%%
%%
%% It seems that we cannot check which fonts that we can use by
%% XeTex itself, perhaps that's why I prefer LuaTeX to XeTeX.
%%
%% The following are fonts that you can found on Fedora and Ubuntu.
%% Sans-serif fonts/heiti or youti:
%% WenQuanYi Zen Hei, WenQuanYi Micro Hei, Droid Sans Fallback
%%
%% Mono fonts:
%% WenQuanYi Zen Hei Mono, WenQuanYi Micro Hei Mono
%%
%% Serif fonts/songti:
%% WenQuanYi Zen Hei Sharp, AR PL UMing CN
%%
%% Kaishu fonts:
%% AR PL UKai CN
%%
%% Use your fonts to replace the followings
\newcommand\cjkseriffont{@SERIFFONT@}
\newcommand\cjksansfont{@SANSFONT@}
\newcommand\cjkmonofont{@MONOFONT@}
\newcommand\cjkkaifont{@KAISUFONT@}
%%
\fontspec{\cjkseriffont}
\fontspec{\cjksansfont}
\fontspec{\cjkmonofont}
\fontspec{\cjkkaifont}
%%
\setCJKmainfont{\cjkseriffont}
\setCJKsansfont{\cjksansfont}
\setCJKmonofont{\cjkmonofont}
%%
\newCJKfontfamily[song]\songti{\cjkseriffont}
\newCJKfontfamily[hei]\heiti{\cjksansfont}
\newCJKfontfamily[kai]\kaiti{\cjkkaifont}

%%
%%%%%%%%%%%%%%%
%% 2. 超链接 %%
%%%%%%%%%%%%%%%
%% Most of time, we just want a PDF, so hyperlinks among contents and to
%% the Internet will be useful. While to support Chinses, to avoid
%% encoding problems, it is better to enable hyperref with xecte
\usepackage[unicode, pdfencoding=auto, backref]{hyperref}
\hypersetup{
  colorlinks=true,
%  bookmarks=true,
  bookmarksopen=true,
%  pdfpagemode=FullScreen,
  pdfstartview=Fit,
  pdftitle={@PDF_TITLE@},
  pdfauthor={@PDF_AUTHOR@},
  pdfkeywords={@PDF_KEYWORDS@},
  pdfsubject={@PDF_SUBJECT@}
}
%%
%%%%%%%%%%%%%
%% 3. 目录 %%
%%%%%%%%%%%%%
%% The following package will add the content itself and reference to
%% the content list.
\usepackage{tocbibind} % 把附录各项加入目录
%% You can configure contens style by one of the following packages.
% \usepackage{tocloft} % Simpler than the titletoc
% \usepackage{titletoc}
%%
%%%%%%%%%%%%%%%%%%%
%% 4. 跨文档互引 %%
%%%%%%%%%%%%%%%%%%%
%% This package implements a system for eXternal References. If one document
%% needs to refer to sections of another, say aaa.tex, then this package may be
%% loaded in the main file, and the command \externaldocument{aaa} given
%% in the preamble
%\usepackage{xr} % 暂时没有需求
%%
%%%%%%%%%%%%%%%%%
%% 5. 参考文献 %%
%%%%%%%%%%%%%%%%%
\bibliographystyle{alpha}
%%
%%%%%%%%%%%%%
%% 5. 索引 %%
%%%%%%%%%%%%%
%\usepackage{imakeidx} % If need support multi-indxes uncomment this line.
\usepackage{makeidx}
\makeindex
%%
%%%%%%%%%%%%%
%% 6. 术语 %%
%%%%%%%%%%%%%
%% We need some options to enable Glossary entry in the Contents.
\usepackage[toc, section=section]{glossaries} % hyper选项不可用
\makeglossaries
%%
%%%%%%%%%%%%%%%%%
%% 6. 版式设置 %%
%%%%%%%%%%%%%%%%%
%% The package will give use a label to the last page.
\usepackage{lastpage}
\usepackage{fancyhdr} % 版式设置
\usepackage{geometry} % 版式设置

%%%%%%%%%%%%%
%% 7. 图形 %%
%%%%%%%%%%%%%
\usepackage{color}
\usepackage{graphicx}
\usepackage{asymptote}
\usepackage{animate}

%%%%%%%%%%%%%%%%%%%%%%%
%% 8. 嵌入和高亮源码 %%
%%%%%%%%%%%%%%%%%%%%%%%
%% algorithmicx支持伪码、C和Pacal。可以定义新语言。
\usepackage{algpseudocode}
\usepackage{algorithm}
%\usepackage{algorithmic}
%% usepackage{minted} % 借助Pygments支持多种语言。需要给lualatex增加选项--shell-escape


%%%%%%%%%%%%%%%%%
%% 9. 正文部分 %%
%%%%%%%%%%%%%%%%%

\title{@PDF_TITLE@}
\author{@PDF_AUTHOR@}
\date{\today}

\begin{document}
\tableofcontents
\listoffigures
\listoftables
%%
\section{为何需要模板？}
正如Linux系统中第一个进程是手工创建而来，其他进程均由之复制因而也是其子进程类似。我们尝试
创建一个模板。而后我们可以复制模板进而以之为基，修改、创建需要的文档。

我们需要模板支持我们需要的全部功能。

\subsection{汉语支持}
明显我们需要支持汉语。我们之中英语困难者不乏其人，使用汉语的人其只能使用
汉语的人又参如星河。\marginpar{信不信有你}

我们且拭目以待。

\begin{center}
曾慮多情損梵行，\par
入山又恐別傾城。\par
世間安得雙全法，\par
不負如來不負卿。\par
\end{center}

再来一首。

\begin{center}
桂靄桐陰坐舉觴，長安涎口盼重陽。\par
眼前道路無經緯，皮裏春秋空黑黃。\par
酒未敵腥還用菊，性防積冷定須姜。\par
於今落釜成何益，月浦空餘禾黍香。\par
\end{center}

这里我们验证了简繁混排是可行的。后面会测试中英混排。\marginpar{其实还测试了用汉语注释的情况}
\subsection{文中互引}
貌似最初没有给出此项如何作。现在验证下，我们看下有关的已知问题记录\ref{known_issue_no_interref}。
\subsection{参考文献}
比着葫芦画飘即可\pageref{bibliography_loc}。
\subsection{索引}
比着葫芦画飘即可\pageref{index_loc}。
\subsection{术语}
比着葫芦画飘即可\pageref{glossaries_loc}。
\section{如何使用此模板？}
此模板运行需要不少工具。至少需要{\href{https://www.gnu.org/}{gnu}}的
{\href{https://www.gnu.org/software/make/}{make}}和
{\href{https://www.gnu.org/software/autoconf/autoconf.html}{Autotools}}。
\marginpar{即使如此，字体部分也可能会造成大麻烦。在Debian
或者其衍生版系统上尝试会较好。}
\subsection{工具和字体}
我们需要\LuaLaTeX\footnote{\href{http://luatex.org/}{
{\LuaLaTeX}是目前更好的选择}}和中文字体\footnote{\href{http://www.freechinesefont.com/}{自由的中文字体让人满意的不多}}，
还有给{\href{https://www.latex-project.org/}{\LaTeX}}增加了汉语支持的{\href{http://www.ctex.org/HomePage/主页}{{\CTeX}宏包}}。
\subsection{引用参考文献}
要进一步了解{\LaTeX}系统，请参考\cite{leslie1994latex}。
\subsection{索引引用}
谁是直寻{\index{直寻}}， 他对数学{\index{mathmatics}}情有独钟？
\subsection{定义和引用术语}
\newglossaryentry{redhat}{
  name={Red Hat},
  description={知名开源操作系统提供商}
  }
\gls{redhat}的RHEL操作系统均是质量上乘之作。
\subsection{创建表格}
我们创建一个表格测试下。\marginpar{表格和图都会浮动，看能否找到它们}
\begin{table}\centering
  \caption{Famous Editors}
\begin{tabular}{|c|c|}\hline
  Name & Description \\ \hline
  Emacs & God{\rq}s Editior \\ \hline
  Vi & Editors{\rq} God \\ \hline
\end{tabular}
\end{table}
\subsection{嵌入和建立图片}
大多时候我们不需要交互式的使用{\TeX}的产出，但是如果必要，我们可以。
\begin{figure}\centering
\includegraphics[scale=0.5]{@abs_srcdir@/pics/tex_inter.png}
\caption{{\TeX} Interactive}
\end{figure}


另一副由{\href{https://asymptote.sourceforge.io/}{asymptote}}生成。
\begin{figure}\centering
\begin{asy}
  real r = 0.8cm;
  for (int i = 0; i < 360; i+=10)
    draw(circle(dir(i) * r, r));
\end{asy}
\caption{Asymptote pic}
\end{figure}
\section{高亮源代码}
源代码（包括伪码）已经是记录和交流的常见工具。测试下高亮代码。
\subsection{\href{https://www.ctan.org/pkg/algorithmicx}{algorithmicx}}
这里我们测试的是伪码。{\href{https://www.ctan.org/pkg/algorithmicx}{algorithmicx}}
依赖{\href{https://www.ctan.org/pkg/algorithms}{algorithms bundle}}
提供的algorithm和algorithmic环境。前者是浮动的。
\begin{algorithm}
\caption{Euclid’s algorithm}\label{euclid}
\begin{algorithmic}[1]
\Procedure{Euclid}{$a,b$}\Comment{The g.c.d. of a and b}
\State $r\gets a\bmod b$
\While{$r\not=0$}\Comment{We have the answer if r is 0}
\State $a\gets b$
\State $b\gets r$
\State $r\gets a\bmod b$
\EndWhile\label{euclidendwhile}
\State \textbf{return} $b$\Comment{The gcd is b}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\section{下一步计划}
\begin{itemize}
\item 如何格式美观的给出代码？
\item 有{\href{https://www.ctan.org/pkg/cweb-latex}{web-latex}}且是发行版的一部分，
支持中文的文学编程，需要搞起来。
\end{itemize}
\section{已知问题}
\subsection{超链接不支持包含汉语的URL}
最初使用{\XeLaTeX}时发现的问题，目前测试无此问题。
\subsection{索引没有生成}
奇也怪载，索引没有看到。

问题已解。Makefile中执行创建索引的命令因为丢失了分号没有执行所致。
\subsection{文中相互引用没有例子}
\label{known_issue_no_interref}貌似最初版本就缺失了这一块内容。

这部分内容已经补充进来了。
\subsection{“术语”中文支持不完全}
关键字和名称不能是汉语。
\subsection{双引号处理有问题}
''这句话两边的双引号有问题''。单引号也有类似问题。但是解决方案是有的：直接输入
全角引号而非{\LaTeX}的引号表达式。
\subsection{文档类型为“book”时排版有误}
边栏提示位置错乱。需要进一步测试。

解决方案是：不使用边栏；边栏位置都调整到右边；调整页面设置。
\appendix
\section{附录}
比着葫芦画飘即可。
\bibliography{@abs_srcdir@/jabref}\label{bibliography_loc}
\printindex\label{index_loc}
\printglossaries\label{glossaries_loc}
\end{document}
